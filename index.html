<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Workshop - Dashboard</title>
    <style>
        :root {
            --discord-blurple: #5865F2;
            --discord-green: #57F287;
            --bg-dark: #23272A;
            --bg-light: #2C2F33;
            --text-main: #FFFFFF;
            --text-sub: #99AAB5;
            --sidebar-width: 250px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'gg sans', 'Segoe UI', sans-serif; }
        body { background-color: var(--bg-dark); color: var(--text-main); overflow-x: hidden; }

        /* --- √âCRAN DE CONNEXION (LANDING PAGE) --- */
        #landing-page { display: block; }
        
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(rgba(35, 39, 42, 0.9), rgba(35, 39, 42, 0.9)), url('https://images.unsplash.com/photo-1614680376593-902f74cf0d41?q=80&w=1974');
            background-size: cover;
            padding: 20px;
        }

        .hero h1 { font-size: 3rem; margin-bottom: 1rem; }
        .hero p { font-size: 1.2rem; color: var(--text-sub); max-width: 600px; margin-bottom: 2rem; }

        .btn-discord {
            background-color: var(--discord-blurple);
            color: white;
            padding: 1rem 2rem;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s, background 0.3s;
            cursor: pointer;
            border: none;
        }
        .btn-discord:hover { background-color: #4752C4; transform: scale(1.05); }

        /* --- DASHBOARD (Cach√© par d√©faut) --- */
        #dashboard-page { display: none; height: 100vh; }

        .dashboard-container { display: flex; height: 100%; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #1e2124;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profile-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #424549;
            width: 100%;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--discord-green);
            margin-bottom: 10px;
        }

        .username { font-weight: bold; font-size: 1.1rem; }
        .user-id { font-size: 0.8rem; color: var(--text-sub); }

        .menu-items { width: 100%; }
        .menu-item {
            display: block;
            padding: 12px;
            color: var(--text-sub);
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: 0.2s;
        }
        .menu-item:hover, .menu-item.active { background-color: var(--discord-blurple); color: white; }

        /* Content */
        .content { flex: 1; padding: 40px; overflow-y: auto; background-color: var(--bg-light); }
        .card { background-color: var(--bg-dark); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .welcome-banner { background: linear-gradient(90deg, var(--discord-blurple), #8e44ad); padding: 30px; border-radius: 15px; margin-bottom: 30px; }

    </style>
</head>
<body>

    <div id="landing-page">
        <div class="hero">
            <h1>Discord Workshop</h1>
            <p>Le serveur communautaire d√©di√© au d√©veloppement. Connectez-vous pour acc√©der √† vos outils et rejoindre la communaut√©.</p>
            
            <button onclick="login()" class="btn-discord">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286z"/></svg>
                Se connecter avec Discord
            </button>
        </div>
    </div>

    <div id="dashboard-page">
        <div class="dashboard-container">
            <div class="sidebar">
                <div class="profile-section">
                    <img id="userAvatar" src="" alt="Avatar" class="avatar">
                    <div id="userName" class="username">Chargement...</div>
                    <div id="userId" class="user-id">#0000</div>
                </div>
                <div class="menu-items">
                    <a href="#" class="menu-item active">üè† Accueil</a>
                    <a href="#" class="menu-item">üìö Mes Cours</a>
                    <a href="https://discord.gg/RVEm68wJBj" target="_blank" class="menu-item">üí¨ Support Discord</a>
                    <a href="#" onclick="logout()" class="menu-item" style="color: #f04747; margin-top: 20px;">üö™ D√©connexion</a>
                </div>
            </div>

            <div class="content">
                <div class="welcome-banner">
                    <h2 id="welcomeTitle">Bienvenue !</h2>
                    <p>Vous √™tes maintenant connect√© √† l'espace membre de Discord Workshop.</p>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <h3>üöÄ Statut du Serveur</h3>
                        <p>Vous avez rejoint le programme d'acc√©l√©ration.</p>
                    </div>
                    <div class="card">
                        <h3>üì¢ Annonces</h3>
                        <p>Le prochain atelier sur les Bots Discord aura lieu samedi.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const CLIENT_ID = '1470373199983415329';
        // IMPORTANT : L'URL doit correspondre EXACTEMENT √† celle dans le portail d√©veloppeur Discord
        const REDIRECT_URI = 'https://jojolm24.github.io/Dev-center/'; 
        
        // Fonction de connexion
        function login() {
            // On utilise 'token' au lieu de 'code' pour avoir l'acc√®s direct sans backend (Implicit Grant)
            // On demande 'identify' pour le profil et 'guilds.join' pour l'invitation
            const scope = encodeURIComponent('identify guilds.join');
            const url = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${scope}`;
            window.location.href = url;
        }

        // Fonction ex√©cut√©e au chargement de la page
        window.onload = () => {
            // V√©rifier si l'URL contient un token (retour de connexion)
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get('access_token');
            const tokenType = fragment.get('token_type');

            if (accessToken) {
                // Utilisateur connect√© !
                showDashboard();
                fetchDiscordProfile(tokenType, accessToken);
                
                // Tentative d'auto-join (Ouverture du lien d'invitation)
                // Note: Sur un site statique, on ne peut pas forcer le join via API sans exposer le Bot Token.
                // On redirige donc poliment vers l'invitation dans un nouvel onglet si besoin.
                console.log("Tentative d'ajout au serveur...");
                setTimeout(() => {
                   // Optionnel : Ouvrir l'invitation si on veut √™tre s√ªr qu'il rejoint
                   // window.open('https://discord.gg/RVEm68wJBj', '_blank'); 
                }, 2000);

                // Nettoyer l'URL pour faire propre
                window.history.replaceState({}, document.title, "/Dev-center/");
            } else {
                // Pas connect√©
                document.getElementById('landing-page').style.display = 'block';
                document.getElementById('dashboard-page').style.display = 'none';
            }
        };

        function showDashboard() {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'block';
        }

        function fetchDiscordProfile(tokenType, accessToken) {
            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `${tokenType} ${accessToken}`
                }
            })
            .then(result => result.json())
            .then(response => {
                const { username, discriminator, id, avatar } = response;
                
                // Mise √† jour du profil
                document.getElementById('userName').innerText = username;
                document.getElementById('userId').innerText = `#${discriminator}`; // Note: discriminator dispara√Æt bient√¥t sur Discord
                document.getElementById('welcomeTitle').innerText = `Bienvenue, ${username} !`;

                // Gestion de l'avatar
                if (avatar) {
                    const avatarUrl = `https://cdn.discordapp.com/avatars/${id}/${avatar}.png`;
                    document.getElementById('userAvatar').src = avatarUrl;
                } else {
                    document.getElementById('userAvatar').src = "https://cdn.discordapp.com/embed/avatars/0.png";
                }
            })
            .catch(console.error);
        }

        function logout() {
            // Pour se d√©connecter, on recharge la page sans le hash
            window.location.href = REDIRECT_URI;
        }
    </script>
</body>
</html>
